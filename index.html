<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#040C14">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Society Cricket Fantasy</title>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#040C14;--s1:#07111E;--s2:#0B1929;--card:#0E1F30;--card2:#122539;
  --border:#173045;--b2:#1E3F5A;
  --g:#00E8A2;--gold:#F5C518;--red:#F04D4D;--blue:#3DA3FF;--pur:#A78BFA;
  --text:#D8EEF8;--dim:#4A7090;--dim2:#2A4A60;
  --gg:linear-gradient(135deg,#00E8A2 0%,#00C4D4 100%);
  --glow:0 0 30px rgba(0,232,162,.22);
  --font-hd:'Oswald',sans-serif;--font-bd:'DM Sans',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:var(--font-bd);overflow:hidden;font-size:15px}
@keyframes FI{from{opacity:0}to{opacity:1}}
@keyframes SU{from{transform:translateY(18px);opacity:0}to{transform:none;opacity:1}}
@keyframes BLK{0%,100%{opacity:1}50%{opacity:0}}
@keyframes SP{to{transform:rotate(360deg)}}

/* SHELL */
#app{height:100dvh;display:flex;flex-direction:column;animation:FI .3s ease}
.pages{flex:1;overflow:hidden;position:relative}
.page{position:absolute;inset:0;overflow-y:auto;overscroll-behavior:contain;padding-bottom:74px;display:none;-webkit-overflow-scrolling:touch}
.page.active{display:block}

/* HEADER */
.hdr{background:var(--s1);padding:10px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;position:relative}
.hdr::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--g),transparent);opacity:.25}
.brand-logo{font-family:var(--font-hd);font-size:20px;letter-spacing:3px;color:var(--g)}
.brand-sub{font-size:9px;color:var(--dim);letter-spacing:2px;text-transform:uppercase;margin-top:1px}
.hdr-r{display:flex;gap:7px;align-items:center}
.chip{border:1px solid var(--border);border-radius:20px;padding:5px 11px;font-size:12px;font-family:var(--font-bd);font-weight:600;cursor:pointer;background:transparent;color:var(--dim);transition:all .2s}
.chip:hover{border-color:var(--blue);color:var(--blue)}
.chip.active{border-color:var(--g);color:var(--g)}

/* SYNC BAR */
.sbar{background:var(--s2);border-bottom:1px solid var(--border);padding:4px 14px;font-size:11px;color:var(--dim);display:flex;align-items:center;gap:7px;flex-shrink:0;min-height:24px}
.sdot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.sdot.ok{background:var(--g)}.sdot.err{background:var(--red)}.sdot.wait{background:var(--gold);animation:BLK 1s infinite}

/* BOTTOM NAV */
.bnav{position:fixed;bottom:0;left:0;right:0;height:62px;background:var(--s1);border-top:1px solid var(--border);display:flex;z-index:40}
.bni{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;cursor:pointer;color:var(--dim);transition:color .2s;position:relative;user-select:none}
.bni.active{color:var(--g)}
.bni.active::before{content:'';position:absolute;top:0;left:20%;right:20%;height:2px;background:var(--gg);border-radius:0 0 4px 4px}
.bni-ic{font-size:19px;line-height:1}
.bni-lb{font-family:var(--font-hd);font-size:9px;letter-spacing:1.5px;text-transform:uppercase}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;border:none;border-radius:10px;font-family:var(--font-hd);font-size:14px;letter-spacing:1px;cursor:pointer;transition:transform .15s;text-transform:uppercase;padding:12px 18px}
.btn:active{transform:scale(.96)}
.btn-g{background:var(--gg);color:#031210;box-shadow:var(--glow);font-weight:600}
.btn-ol{background:transparent;color:var(--g);border:1.5px solid var(--g)}
.btn-ghost{background:transparent;color:var(--dim);border:1px solid var(--border)}
.btn-red{background:transparent;color:var(--red);border:1.5px solid rgba(240,77,77,.3)}
.btn-sm{padding:6px 11px;font-size:11px;border-radius:7px}
.btn-full{width:100%;display:flex;padding:14px}
.btn-full:disabled{background:var(--border)!important;color:var(--dim)!important;box-shadow:none!important;cursor:not-allowed!important;transform:none!important}

/* SETUP SCREEN */
#setup{position:fixed;inset:0;z-index:9999;background:var(--bg);overflow-y:auto;padding:20px 16px 60px;display:flex;flex-direction:column;align-items:center}
.setup-logo{font-family:var(--font-hd);font-size:40px;letter-spacing:6px;color:var(--g);text-align:center;margin-top:10px}
.setup-sub{font-size:11px;color:var(--dim);letter-spacing:3px;text-transform:uppercase;margin:5px 0 20px;text-align:center}
.sbox{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;width:100%;max-width:460px;margin-bottom:12px}
.sbox-t{font-family:var(--font-hd);font-size:16px;letter-spacing:.5px;margin-bottom:3px;display:flex;align-items:center;gap:8px}
.sbox-s{font-size:12px;color:var(--dim);margin-bottom:14px;line-height:1.65}
.flbl{font-family:var(--font-hd);font-size:10px;color:var(--dim);letter-spacing:1.5px;text-transform:uppercase;display:block;margin-bottom:5px}
.finp{width:100%;background:var(--s2);border:1.5px solid var(--border);border-radius:9px;padding:11px 13px;font-family:var(--font-bd);font-size:13px;color:var(--text);outline:none;transition:border-color .2s;margin-bottom:10px}
.finp:focus{border-color:var(--g)}
.finp::placeholder{color:var(--dim)}
.finp:last-of-type{margin-bottom:0}
.step-row{display:flex;gap:10px;align-items:flex-start;margin-bottom:10px}
.snum{width:24px;height:24px;border-radius:50%;background:var(--gg);color:#031210;font-family:var(--font-hd);font-size:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px;font-weight:700}
.stext{font-size:13px;color:var(--text);line-height:1.65}
.stext code{background:var(--s2);color:var(--gold);padding:1px 6px;border-radius:4px;font-size:11px;font-family:monospace}
.stext b{color:var(--text)}
.stext a{color:var(--blue)}
.gas-code{background:var(--s2);border:1px solid var(--b2);border-radius:10px;padding:13px;font-family:monospace;font-size:11px;color:#afd6f5;line-height:1.7;white-space:pre;overflow-x:auto;margin:10px 0 4px;max-height:280px;overflow-y:auto}
.copy-btn{font-size:11px;color:var(--blue);cursor:pointer;text-decoration:underline;font-family:var(--font-bd)}
.or-sep{text-align:center;color:var(--dim);font-size:12px;margin:8px 0}
.green-strip{background:rgba(0,232,162,.06);border:1px solid rgba(0,232,162,.2);border-radius:10px;padding:11px 13px;font-size:12px;color:var(--g);line-height:1.7;margin-bottom:10px}

/* LOADING / ERROR */
.ld{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;gap:14px}
.spinner{width:34px;height:34px;border:3px solid var(--border);border-top-color:var(--g);border-radius:50%;animation:SP .8s linear infinite}
.ld-lbl{font-family:var(--font-hd);font-size:12px;letter-spacing:2px;color:var(--dim)}

/* MATCH HERO */
.hero{margin:12px;background:var(--card);border-radius:18px;border:1px solid var(--border);overflow:hidden;animation:SU .4s ease;position:relative}
.hero::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(0,232,162,.04) 0%,transparent 55%,rgba(245,197,24,.03) 100%);pointer-events:none}
.hero-top{padding:18px 16px;text-align:center;position:relative}
.hero-bg{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:130px;opacity:.035;pointer-events:none}
.live-pill{display:inline-flex;align-items:center;gap:5px;background:rgba(0,232,162,.09);border:1px solid rgba(0,232,162,.22);color:var(--g);border-radius:20px;padding:4px 12px;font-family:var(--font-hd);font-size:11px;letter-spacing:1.5px;margin-bottom:14px}
.lpulse{width:7px;height:7px;border-radius:50%;background:var(--red);animation:BLK 1s infinite}
.vs-row{display:flex;align-items:center;justify-content:center;gap:16px}
.tside{text-align:center;flex:1;min-width:0}
.tem{font-size:42px;display:block;margin-bottom:6px;line-height:1}
.tnm{font-family:var(--font-hd);font-size:15px;letter-spacing:.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.vsbadge{width:38px;height:38px;border-radius:50%;background:var(--gg);display:flex;align-items:center;justify-content:center;font-family:var(--font-hd);font-size:14px;color:#031210;font-weight:700;flex-shrink:0}
.hero-meta{font-size:11px;color:var(--dim);margin-top:10px}
.hero-acts{display:flex;gap:10px;padding:11px 12px}
.hero-acts .btn{flex:1}

/* STAT STRIP */
.stat-strip{display:flex;gap:8px;padding:0 12px 12px}
.sstat{flex:1;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px 6px;text-align:center;position:relative;overflow:hidden}
.sstat::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--gg);opacity:.25}
.sstat-n{font-family:var(--font-hd);font-size:22px;color:var(--g);line-height:1}
.sstat-l{font-size:9px;color:var(--dim);text-transform:uppercase;letter-spacing:.5px;margin-top:3px}

/* SCORE SHOWCASE */
.showcase{margin:0 12px 12px;background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.sc-hdr{padding:9px 13px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);background:rgba(0,232,162,.05)}
.sc-hdr-t{font-family:var(--font-hd);font-size:13px;letter-spacing:1px;color:var(--g)}
.sc-scroll{display:flex;gap:9px;padding:10px 11px 9px;overflow-x:auto}
.sc-pl{flex-shrink:0;text-align:center;width:58px}
.sc-av{width:44px;height:44px;border-radius:50%;background:var(--s2);border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:20px;margin:0 auto 4px;position:relative}
.sc-tag{position:absolute;bottom:-7px;left:50%;transform:translateX(-50%);background:var(--gold);color:#1a0a00;border-radius:9px;padding:0 5px;font-family:var(--font-hd);font-size:9px;white-space:nowrap;font-weight:700}
.sc-nm{font-size:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:8px}
.sc-role{font-size:9px;color:var(--dim)}

/* SECTION */
.sec{padding:13px 14px 7px;display:flex;align-items:center;justify-content:space-between}
.sec-t{font-family:var(--font-hd);font-size:11px;letter-spacing:2px;color:var(--dim);text-transform:uppercase}

/* PLAYER CARDS */
.plist{padding:0 12px}
.pc{background:var(--card);border:1px solid var(--border);border-radius:12px;display:flex;align-items:center;gap:9px;padding:10px 11px;margin-bottom:7px;cursor:pointer;transition:border-color .18s,background .18s;position:relative;overflow:hidden}
.pc::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px 0 0 3px;background:transparent;transition:background .18s}
.pc.sel{border-color:rgba(0,232,162,.45);background:rgba(0,232,162,.04)}
.pc.sel::before{background:var(--g)}
.pav{width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,#152e46,#0a1e30);display:flex;align-items:center;justify-content:center;font-size:22px;border:2px solid var(--border);flex-shrink:0;position:relative;transition:border-color .18s}
.pc.sel .pav{border-color:rgba(0,232,162,.55)}
.cpin{position:absolute;bottom:-3px;right:-3px;width:17px;height:17px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:700;font-family:var(--font-hd);color:#000}
.cpinC{background:var(--gold)}.cpinVC{background:var(--red)}
.pinfo{flex:1;min-width:0}
.pname{font-family:var(--font-bd);font-size:14.5px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pmeta{display:flex;gap:5px;align-items:center;margin-top:3px}
.rt{font-size:9px;padding:2px 6px;border-radius:4px;font-family:var(--font-hd);letter-spacing:.5px}
.rt-wk{background:rgba(61,163,255,.14);color:var(--blue)}.rt-bat{background:rgba(245,197,24,.14);color:var(--gold)}.rt-bwl{background:rgba(240,77,77,.14);color:var(--red)}.rt-all{background:rgba(0,232,162,.14);color:var(--g)}
.pteam{font-size:10px;color:var(--dim);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pr{text-align:right;flex-shrink:0;min-width:50px}
.ppts{font-family:var(--font-hd);font-size:20px;color:var(--gold);line-height:1}
.pptsl{font-size:9px;color:var(--dim)}
.pcr{font-size:11px;color:var(--dim);margin-top:2px}
.pchk{width:24px;height:24px;border-radius:50%;border:2px solid var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:11px;transition:all .18s;color:transparent}
.pc.sel .pchk{background:var(--g);border-color:var(--g);color:#031210}

/* SQUAD */
.sq-stick{position:sticky;top:0;z-index:10;background:var(--bg);padding:10px 13px 8px;border-bottom:1px solid var(--border)}
.sq-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:7px}
.sq-cnt{font-family:var(--font-hd);font-size:21px;letter-spacing:1px}
.sq-cnt em{color:var(--g);font-style:normal}
.sq-cr{font-size:12px;color:var(--dim)}.sq-cr b{color:var(--gold)}
.sq-prog{height:4px;background:var(--border);border-radius:2px;overflow:hidden;margin-bottom:8px}
.sq-fill{height:100%;background:var(--gg);border-radius:2px;transition:width .3s}
.pills{display:flex;gap:5px;overflow-x:auto;padding-bottom:2px}
.pill{flex-shrink:0;padding:5px 12px;border-radius:20px;border:1px solid var(--border);font-size:11px;font-family:var(--font-hd);cursor:pointer;color:var(--dim);background:transparent;transition:all .18s;letter-spacing:.5px}
.pill.on{background:var(--g);color:#031210;border-color:var(--g)}
.sqsearch{margin:7px 12px 0;background:var(--card);border:1px solid var(--border);border-radius:9px;display:flex;align-items:center;gap:7px;padding:8px 11px}
.sqsearch input{flex:1;background:transparent;border:none;outline:none;font-family:var(--font-bd);font-size:13.5px;color:var(--text)}
.sqsearch input::placeholder{color:var(--dim)}
.role-grp-hdr{font-family:var(--font-hd);font-size:11px;color:var(--dim);letter-spacing:2px;text-transform:uppercase;padding:11px 12px 5px}
.bot-bar{position:fixed;bottom:0;left:0;right:0;padding:9px 12px 12px;background:linear-gradient(0deg,var(--bg) 65%,transparent);z-index:20;display:flex;gap:8px}

/* PITCH */
.pitch{background:linear-gradient(180deg,#05301e,#074d2a,#05301e);border-radius:16px;padding:14px 6px;margin:12px;border:1px solid rgba(0,232,162,.1);position:relative;min-height:370px}
.pitch-lines{position:absolute;inset:0;background:repeating-linear-gradient(180deg,rgba(255,255,255,.018) 0,rgba(255,255,255,.018) 1px,transparent 1px,transparent 44px);pointer-events:none;border-radius:16px}
.prow{display:flex;justify-content:center;gap:7px;margin:7px 0;flex-wrap:wrap}
.pp{display:flex;flex-direction:column;align-items:center;gap:3px;width:64px}
.pp-av{width:46px;height:46px;border-radius:50%;border:2px solid rgba(255,255,255,.18);background:rgba(0,0,0,.3);display:flex;align-items:center;justify-content:center;font-size:21px;position:relative}
.pp-nm{font-family:var(--font-bd);font-size:10px;font-weight:600;text-align:center;background:rgba(0,0,0,.55);border-radius:5px;padding:2px 4px;max-width:64px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pp-pts{font-size:10px;color:var(--gold);font-family:var(--font-hd)}

/* LEADERBOARD */
.lb-hero{background:linear-gradient(155deg,#0C1840,#060D1D);border-radius:16px;margin:12px;padding:20px;text-align:center;border:1px solid var(--border);position:relative;overflow:hidden}
.lb-bg{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:140px;opacity:.035;pointer-events:none}
.lb-t{font-family:var(--font-hd);font-size:30px;letter-spacing:5px;color:var(--gold)}
.lb-s{font-size:10px;color:var(--dim);letter-spacing:2px;margin-top:5px;text-transform:uppercase}
.podium{display:flex;align-items:flex-end;justify-content:center;gap:10px;padding:12px 12px 18px}
.pod{display:flex;flex-direction:column;align-items:center;gap:4px}
.pod-av{border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid var(--dim);background:rgba(0,0,0,.3)}
.pod1 .pod-av{width:64px;height:64px;font-size:32px;border-color:var(--gold);box-shadow:0 0 20px rgba(245,197,24,.3)}
.pod2 .pod-av,.pod3 .pod-av{width:50px;height:50px;font-size:26px}
.pod3 .pod-av{border-color:#B87333}
.pod-nm{font-family:var(--font-bd);font-size:11px;font-weight:600;text-align:center;max-width:72px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pod-sc{font-family:var(--font-hd);font-size:15px;color:var(--g)}
.pod-stand{border-radius:7px 7px 0 0;width:70px}
.ps1{height:62px;background:rgba(245,197,24,.12);border:1px solid rgba(245,197,24,.28)}
.ps2{height:46px;background:rgba(110,110,110,.12);border:1px solid rgba(110,110,110,.22)}
.ps3{height:32px;background:rgba(184,115,51,.12);border:1px solid rgba(184,115,51,.22)}
.pod-rk{font-size:9px;color:var(--dim);font-family:var(--font-hd);letter-spacing:1px}
.lb-list{display:flex;flex-direction:column;gap:6px;padding:0 12px 12px}
.lb-row{background:var(--card);border:1px solid var(--border);border-radius:11px;display:flex;align-items:center;gap:9px;padding:10px 12px;animation:SU .3s ease both}
.lb-rk{font-family:var(--font-hd);font-size:20px;color:var(--dim);width:26px;text-align:center}
.lb-av{width:40px;height:40px;border-radius:50%;background:var(--s2);display:flex;align-items:center;justify-content:center;font-size:19px}
.lb-info{flex:1}
.lb-nm{font-family:var(--font-bd);font-size:15px;font-weight:600}
.lb-tnm{font-size:10px;color:var(--dim);margin-top:1px}
.lb-sc{font-family:var(--font-hd);font-size:21px;color:var(--g)}

/* ADMIN */
.adm-pg{padding:12px}
.adm-login{display:flex;flex-direction:column;align-items:center;padding:36px 16px 20px;gap:14px;text-align:center}
.atabs{display:flex;gap:5px;overflow-x:auto;margin-bottom:12px;padding-bottom:2px}
.atab{flex-shrink:0;padding:6px 13px;border-radius:20px;border:1px solid var(--border);font-family:var(--font-hd);font-size:11px;cursor:pointer;color:var(--dim);background:var(--card);transition:all .2s;letter-spacing:.5px}
.atab.on{background:rgba(61,163,255,.1);color:var(--blue);border-color:var(--blue)}
.acard{background:var(--card);border:1px solid var(--border);border-radius:13px;margin-bottom:10px;overflow:hidden;animation:SU .3s ease}
.acard-hdr{padding:11px 13px;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;justify-content:space-between}
.acard-t{font-family:var(--font-hd);font-size:15px;letter-spacing:.3px}
.acard-s{font-size:11px;color:var(--dim);margin-top:2px}
.acard-body{padding:13px}
.fg{display:flex;gap:7px;flex-wrap:wrap;margin-bottom:9px}
.fw{flex:1;min-width:120px}
.fw label{font-family:var(--font-hd);font-size:10px;color:var(--dim);letter-spacing:1.5px;display:block;margin-bottom:5px;text-transform:uppercase}
.fw .finp{margin-bottom:0}
select.finp option{background:var(--card)}
.sc-ec{background:var(--card2);border:1px solid var(--border);border-radius:11px;overflow:hidden;margin-bottom:7px}
.sc-eh{display:flex;align-items:center;gap:9px;padding:9px 11px;cursor:pointer}
.sc-enm{font-family:var(--font-bd);font-size:14px;font-weight:600;flex:1}
.sc-live{font-family:var(--font-hd);font-size:17px;color:var(--gold)}
.sc-fields{display:flex;gap:5px;flex-wrap:wrap;padding:9px 11px;border-top:1px solid var(--border)}
.sff{display:flex;flex-direction:column;gap:3px;flex:1;min-width:58px}
.sff label{font-family:var(--font-hd);font-size:9px;color:var(--dim);letter-spacing:.5px;text-transform:uppercase}
.sfinp{background:var(--s1);border:1px solid var(--border);border-radius:7px;padding:7px;font-family:var(--font-hd);font-size:15px;color:var(--text);outline:none;text-align:center;width:100%;transition:border-color .2s}
.sfinp:focus{border-color:var(--g)}
.fbox{background:var(--s2);border:1px solid var(--border);border-radius:12px;padding:13px;margin-bottom:11px}
.fbox-t{font-family:var(--font-hd);font-size:11px;color:var(--dim);letter-spacing:1.5px;margin-bottom:9px;text-transform:uppercase}
.fgrid{display:grid;grid-template-columns:1fr 1fr;gap:4px}
.fi{display:flex;justify-content:space-between;padding:5px 8px;background:var(--card);border-radius:6px;font-size:11.5px}
.fil{color:var(--dim)}.fiv{font-family:var(--font-hd);color:var(--gold)}
.dtbl{width:100%;border-collapse:collapse}
.dtbl th{font-family:var(--font-hd);font-size:10px;color:var(--dim);letter-spacing:1px;text-transform:uppercase;padding:7px 9px;text-align:left;border-bottom:1px solid var(--border)}
.dtbl td{padding:7px 9px;border-bottom:1px solid rgba(23,48,69,.5);font-size:12.5px;vertical-align:middle}
.dtbl tr:last-child td{border-bottom:none}
.td-del{background:transparent;border:none;color:var(--red);cursor:pointer;padding:3px 7px;border-radius:6px;font-size:12px}

/* MODAL */
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.82);z-index:100;display:flex;align-items:flex-end;opacity:0;pointer-events:none;transition:opacity .28s}
.backdrop.open{opacity:1;pointer-events:all}
.modal{background:var(--s1);border-radius:22px 22px 0 0;padding:17px;width:100%;border-top:1px solid var(--border);transform:translateY(100%);transition:transform .28s ease;max-height:88vh;overflow-y:auto}
.backdrop.open .modal{transform:none}
.mdrag{width:38px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 17px}
.mt{font-family:var(--font-hd);font-size:24px;letter-spacing:2px;text-align:center;margin-bottom:4px}
.ms{font-size:12px;color:var(--dim);text-align:center;margin-bottom:16px}
.mopts{display:flex;flex-direction:column;gap:7px}
.mopt{display:flex;align-items:center;justify-content:space-between;padding:12px 13px;border-radius:10px;border:1.5px solid var(--border);background:var(--card);cursor:pointer;font-family:var(--font-bd);font-size:15px;font-weight:600;transition:all .18s}
.mopt.sel{border-color:var(--g);background:rgba(0,232,162,.06);color:var(--g)}
.mopt:active{transform:scale(.98)}
.mopt-r{font-size:12px;color:var(--dim)}.mopt.sel .mopt-r{color:var(--g)}
.mclose{width:100%;padding:12px;border-radius:10px;border:none;background:var(--border);color:var(--dim);font-family:var(--font-hd);font-size:13px;letter-spacing:1px;cursor:pointer;margin-top:7px}

/* TOAST */
.toast{position:fixed;top:70px;left:50%;transform:translateX(-50%) translateY(-10px);background:var(--card2);border:1px solid var(--border);border-radius:30px;padding:8px 18px;font-family:var(--font-hd);font-size:12px;letter-spacing:.5px;z-index:600;opacity:0;transition:all .27s;white-space:nowrap;box-shadow:0 8px 32px rgba(0,0,0,.55)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.ok{border-color:var(--g);color:var(--g)}.toast.err{border-color:var(--red);color:var(--red)}.toast.warn{border-color:var(--gold);color:var(--gold)}.toast.info{border-color:var(--blue);color:var(--blue)}
::-webkit-scrollbar{width:3px;height:3px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SETUP SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="setup">
  <div class="setup-logo">ğŸ LCL ğŸ</div>
  <div class="setup-sub">LakeVista Cricket League Fantasy</div>

  <!-- OPTION A: Apps Script -->
  <div class="sbox">
    <div class="sbox-t" style="color:var(--g)">âš¡ Connect via Google Apps Script <span style="font-size:10px;background:rgba(0,232,162,.1);border:1px solid rgba(0,232,162,.2);color:var(--g);padding:2px 8px;border-radius:10px;font-family:var(--font-hd);letter-spacing:1px">RECOMMENDED</span></div>
    <div class="sbox-s">One-time setup. Paste your Apps Script URL below â€” this bypasses all CORS issues permanently.</div>

    <input type="hidden" class="finp" id="gas-url" placeholder="https://script.google.com/macros/s/AKfycbyldOyhLvOKhTvQawO449kDEdbDj4SdJStM_moL8Ejszcl1G2yfPC9obFhdhatBgw-GRA/exec">
 
    <button class="btn btn-g btn-full" onclick="connectGAS()" style="margin-bottom:10px">CONNECT & LOAD â†’</button>

    <div style="border-top:1px solid var(--border);padding-top:14px;margin-top:4px">
      <div style="font-family:var(--font-hd);font-size:12px;color:var(--dim);letter-spacing:1px;margin-bottom:10px">HOW TO SET UP APPS SCRIPT (one time, ~3 minutes):</div>
      <div class="step-row"><div class="snum">1</div><div class="stext">Open your Google Sheet â†’ click <b>Extensions</b> â†’ <b>Apps Script</b></div></div>
      <div class="step-row"><div class="snum">2</div><div class="stext">Delete all existing code, paste the code below, click <b>Save (ğŸ’¾)</b></div></div>

      <div class="gas-code" id="gas-code-block">function doGet(e) {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var out = { players: [], match: {}, ok: true };

  try {
    // Read Players sheet
    var plSheet = ss.getSheetByName("Players");
    if (!plSheet) plSheet = ss.getSheets()[1]; // fallback to 2nd sheet
    var plData = plSheet.getDataRange().getValues();
    var roleMap = {"WK":"WK","BAT":"BAT","ALL-R":"ALL-R","ALLR":"ALL-R","AR":"ALL-R","BOWL":"BOWL","BWL":"BOWL"};
    var emojiMap = {"WK":"ğŸ§¤","BAT":"ğŸ","ALL-R":"ğŸŒŸ","BOWL":"ğŸ¯"};
    for (var i = 2; i < plData.length; i++) {
      var r = plData[i];
      var nm = String(r[1] || "").trim();
      if (!nm || nm === "0") continue;
      var role = String(r[3] || "BAT").toUpperCase().trim().replace(/[^A-Z\-]/g,"");
      role = roleMap[role] || "BAT";
      out.players.push({
        name: nm,
        team: String(r[2] || ""),
        role: role,
        cr:   parseFloat(r[4]) || 8,
        emoji: String(r[5] || emojiMap[role] || "ğŸ"),
        pts:  parseFloat(r[6]) || 0
      });
    }

    // Read Matches sheet
    try {
      var mSheet = ss.getSheetByName("Matches");
      if (!mSheet) mSheet = ss.getSheets()[3];
      var mData = mSheet.getDataRange().getValues();
      var activeNum = parseInt(mData[1][3]) || 1;
      var mRows = mData.filter(function(r){ return !isNaN(parseInt(r[0])) && parseInt(r[0]) > 0; });
      var mRow = mRows[activeNum - 1] || mRows[0];
      if (mRow) {
        out.match = { name: String(mRow[1]||"Match 1"), t1: String(mRow[2]||"Team A"),
          t2: String(mRow[3]||"Team B"), date: String(mRow[4]||""), status: String(mRow[5]||"live").toLowerCase() };
      }
    } catch(me) { out.match = { name:"Match 1", t1:"Team A", t2:"Team B", status:"live", date:"" }; }

  } catch(e) { out.ok = false; out.error = e.toString(); }

  return ContentService.createTextOutput(JSON.stringify(out))
    .setMimeType(ContentService.MimeType.JSON);
}</div>
      <span class="copy-btn" onclick="copyGASCode()">ğŸ“‹ Copy code to clipboard</span>

      <div class="step-row" style="margin-top:12px"><div class="snum">3</div><div class="stext">Click <b>Deploy â†’ New deployment</b> â†’ Type: <b>Web app</b> â†’ Execute as: <b>Me</b> â†’ Who has access: <b>Anyone</b> â†’ click <b>Deploy</b></div></div>
      <div class="step-row"><div class="snum">4</div><div class="stext">Copy the <b>Web app URL</b> (starts with <code>https://script.google.com/macros/s/</code>) and paste it above</div></div>
      <div class="step-row"><div class="snum">5</div><div class="stext">When asked to authorize, click <b>Review permissions â†’ Advanced â†’ Go to (unsafe) â†’ Allow</b></div></div>
    </div>
  </div>

  <!-- OPTION B: Demo -->
  <div class="sbox">
    <div class="sbox-t" style="color:var(--gold)">ğŸ® Demo Mode</div>
    <div class="sbox-s">Use sample data instantly â€” no sheet setup needed. Great for testing the app. You can connect your sheet later via âš™ï¸ Admin.</div>
    <button class="btn btn-ol btn-full" onclick="useDemoMode()">USE DEMO MODE â†’</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app" style="display:none">
  <div class="hdr">
    <div>
      <div style="display:flex;align-items:center;gap:7px">
        <span class="brand-logo">ğŸ LCL ğŸ</span>
        <div style="width:7px;height:7px;border-radius:50%;background:var(--g);animation:BLK 2s infinite;box-shadow:0 0 8px var(--g)"></div>
      </div>
      <div class="brand-sub">LakeVista Cricket League Fantasy</div>
    </div>
    <div class="hdr-r">
      <button class="chip" id="sync-btn" onclick="doSync()">âŸ³ Sync</button>
      <button class="chip" onclick="backToSetup()">âš™ï¸</button>
    </div>
  </div>
  <div class="sbar"><div class="sdot wait" id="sdot"></div><span id="stxt">Loadingâ€¦</span></div>

  <div class="pages">
    <div class="page active" id="pg-home">
      <div id="home-inner"><div class="ld"><div class="spinner"></div><div class="ld-lbl">LOADING DATA</div></div></div>
    </div>
    <div class="page" id="pg-squad">
      <div class="sq-stick">
        <div class="sq-top">
          <div class="sq-cnt"><em id="b-n">0</em>/10 Players</div>
          <div class="sq-cr">Credits left: <b id="b-cr">100.0</b></div>
        </div>
        <div class="sq-prog"><div class="sq-fill" id="b-prog" style="width:0"></div></div>
        <div class="pills">
          <button class="pill on" onclick="setF('ALL',this)">All</button>
          <button class="pill" onclick="setF('WK',this)">ğŸ§¤ WK</button>
          <button class="pill" onclick="setF('BAT',this)">ğŸ Bat</button>
          <button class="pill" onclick="setF('BOWL',this)">ğŸ¯ Bowl</button>
          <button class="pill" onclick="setF('ALL-R',this)">ğŸŒŸ AR</button>
        </div>
        <div class="sqsearch"><span style="color:var(--dim)">ğŸ”</span><input type="text" placeholder="Search player or teamâ€¦" oninput="srch=this.value;renderSq()" id="sq-inp"></div>
      </div>
      <div id="sq-list" style="padding:0 12px"></div>
      <div class="bot-bar">
        <button class="btn btn-ol" style="flex:1" onclick="showPage('home')">â† Back</button>
        <button class="btn btn-g btn-full" style="flex:2" id="sq-nxt" onclick="openCapM()" disabled>Pick C &amp; VC â†’</button>
      </div>
    </div>
    <div class="page" id="pg-myteam"><div id="myteam-c"></div></div>
    <div class="page" id="pg-lb">
      <div class="lb-hero"><div class="lb-bg">ğŸ†</div><div class="lb-t">LEADERBOARD</div><div class="lb-s" id="lb-sub">SOCIETY CRICKET FANTASY</div></div>
      <div class="podium" id="lb-pod"></div>
      <div class="lb-list" id="lb-list"></div>
    </div>
    <div class="page" id="pg-admin">
      <div class="adm-pg">
        <div id="adm-login-wrap">
          <div class="adm-login">
            <div style="font-size:52px">ğŸ”</div>
            <div style="font-family:var(--font-hd);font-size:30px;letter-spacing:4px;color:var(--blue)">ADMIN</div>
            <div style="font-size:12px;color:var(--dim);max-width:280px;line-height:1.6;text-align:center">Enter admin password to manage teams, players, matches and enter scores.</div>
            <div style="width:100%;max-width:300px">
              <label class="flbl">Password</label>
              <input class="finp" type="password" id="adm-pw" placeholder="admin123" onkeydown="if(event.key==='Enter')doLogin()">
            </div>
            <button class="btn btn-g btn-full" style="max-width:300px" onclick="doLogin()">LOGIN â†’</button>
            <div style="font-size:12px;color:var(--dim)">Default: <span style="color:var(--gold);font-family:var(--font-hd)">admin123</span></div>
          </div>
        </div>
        <div id="adm-panel" style="display:none">
          <div class="atabs">
            <button class="atab on" onclick="setATab('matches',this)">ğŸŸï¸ Matches</button>
            <button class="atab" onclick="setATab('scores',this)">ğŸ“Š Scores</button>
            <button class="atab" onclick="setATab('players',this)">ğŸ‘¥ Players</button>
            <button class="atab" onclick="setATab('teams',this)">ğŸ Teams</button>
          </div>
          <div id="adm-content"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="bnav">
    <div class="bni active" id="bni-home" onclick="showPage('home')"><div class="bni-ic">ğŸ </div><div class="bni-lb">Home</div></div>
    <div class="bni" id="bni-squad" onclick="showPage('squad')"><div class="bni-ic">âš¡</div><div class="bni-lb">Create</div></div>
    <div class="bni" id="bni-myteam" onclick="showPage('myteam')"><div class="bni-ic">ğŸ‘•</div><div class="bni-lb">My Team</div></div>
    <div class="bni" id="bni-lb" onclick="showPage('lb')"><div class="bni-ic">ğŸ†</div><div class="bni-lb">Ranks</div></div>
    <div class="bni" id="bni-admin" onclick="showPage('admin')"><div class="bni-ic">âš™ï¸</div><div class="bni-lb">Admin</div></div>
  </div>
</div>

<div class="backdrop" id="mod-cap"><div class="modal"><div class="mdrag"></div><div class="mt">PICK CAPTAIN</div><div class="ms">Captain earns 2Ã— points</div><div class="mopts" id="cap-opts"></div><button class="mclose" onclick="closeM('mod-cap')">Cancel</button></div></div>
<div class="backdrop" id="mod-vc"><div class="modal"><div class="mdrag"></div><div class="mt">PICK VICE-CAPTAIN</div><div class="ms">VC earns 1.5Ã— points</div><div class="mopts" id="vc-opts"></div><button class="mclose" onclick="closeM('mod-vc')">Cancel</button></div></div>
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCORING ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcPts(s){
  if(!s)return 0;
  var r=+(s.runs||0),b=+(s.balls||0),w=+(s.wkts||0),c=+(s.catches||0),
      st=+(s.stmps||0),ro=+(s.runouts||0),m=+(s.maidens||0),dis=!!s.dismissed;
  var p=r*1+w*25+c*10+st*15+ro*12+m*8;
  if(r>=100)p+=50;else if(r>=50)p+=20;
  if(w>=5)p+=30;else if(w>=3)p+=15;
  if(dis&&r===0&&b>=5)p-=5;
  return Math.max(0,p);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var GAS_URL='';
var DEMO=false;
var LAST_SYNC=null;

var DB={
  pw:'admin123',loggedIn:false,activeMid:'m1',
  socTeams:[
    {id:'st1',name:'Roaring Lions',icon:'ğŸ¦'},{id:'st2',name:'Tiger Squad',icon:'ğŸ…'},
    {id:'st3',name:'Fire Eagles',icon:'ğŸ¦…'},{id:'st4',name:'Storm Knights',icon:'âš¡'},
    {id:'st5',name:'Royal Strikers',icon:'ğŸ‘‘'},{id:'st6',name:'Thunder Bulls',icon:'ğŸ‚'}
  ],
  players:[
    {id:1,name:'Rahul Sharma',stid:'st1',role:'WK',emoji:'ğŸ§¤',cr:9.5},
    {id:2,name:'Vikas Nair',stid:'st1',role:'BAT',emoji:'ğŸ',cr:9.0},
    {id:3,name:'Pradeep Iyer',stid:'st1',role:'BOWL',emoji:'ğŸ¯',cr:9.0},
    {id:4,name:'Sanjay Rao',stid:'st1',role:'ALL-R',emoji:'ğŸŒŸ',cr:8.5},
    {id:5,name:'Kiran Joshi',stid:'st1',role:'BAT',emoji:'ğŸ',cr:7.0},
    {id:6,name:'Sunil Mathur',stid:'st1',role:'BOWL',emoji:'ğŸ¯',cr:7.0},
    {id:7,name:'Ankit Bose',stid:'st1',role:'ALL-R',emoji:'ğŸŒŸ',cr:8.0},
    {id:8,name:'Manish Tomar',stid:'st1',role:'BAT',emoji:'ğŸ',cr:6.5},
    {id:9,name:'Nitin Pandey',stid:'st1',role:'BOWL',emoji:'ğŸ¯',cr:8.0},
    {id:10,name:'Deepak Patel',stid:'st2',role:'WK',emoji:'ğŸ§¤',cr:8.0},
    {id:11,name:'Arjun Singh',stid:'st2',role:'BAT',emoji:'ğŸ',cr:10.0},
    {id:12,name:'Amit Verma',stid:'st2',role:'ALL-R',emoji:'ğŸŒŸ',cr:9.5},
    {id:13,name:'Rohit Kumar',stid:'st2',role:'BAT',emoji:'ğŸ',cr:8.5},
    {id:14,name:'Gaurav Tiwari',stid:'st2',role:'BOWL',emoji:'ğŸ¯',cr:8.5},
    {id:15,name:'Suresh Menon',stid:'st2',role:'BAT',emoji:'ğŸ',cr:7.5},
    {id:16,name:'Mohit Gupta',stid:'st2',role:'ALL-R',emoji:'ğŸŒŸ',cr:8.0},
    {id:17,name:'Ravi Saxena',stid:'st2',role:'BOWL',emoji:'ğŸ¯',cr:7.5},
    {id:18,name:'Dev Chauhan',stid:'st2',role:'BAT',emoji:'ğŸ',cr:7.5},
    {id:19,name:'Harish Dubey',stid:'st3',role:'BOWL',emoji:'ğŸ¯',cr:6.5},
    {id:20,name:'Tarun Bhatt',stid:'st3',role:'BOWL',emoji:'ğŸ¯',cr:7.0}
  ],
  matches:[{id:'m1',name:'Match 1',t1:'st1',t2:'st2',status:'live',date:'Today'}],
  scorecards:{},
  mySquad:[],myCap:null,myVC:null,
  lbUsers:[
    {name:'Raj Mehta',emoji:'ğŸ˜',teamName:"Raj's XI",base:820},
    {name:'Priya Singh',emoji:'ğŸ‘‘',teamName:"Queen XI",base:790},
    {name:'Ajay Kumar',emoji:'ğŸ¦',teamName:"Lion Squad",base:775},
    {name:'Neha Sharma',emoji:'âš¡',teamName:"Storm XI",base:740},
    {name:'Vikram Jain',emoji:'ğŸ…',teamName:"Tiger XI",base:720},
    {name:'Sunita Rao',emoji:'ğŸŒŸ',teamName:"Stars",base:695},
    {name:'Manav Gupta',emoji:'ğŸ”¥',teamName:"Blazers",base:670}
  ]
};

var pid_ctr=21,st_ctr=7,m_ctr=2;
var sqFilt='ALL',srch='',sqCr=0,aTab='matches';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function stName(id){var t=DB.socTeams.find(function(x){return x.id===id;});return t?t.name:'â€“';}
function stIcon(id){var t=DB.socTeams.find(function(x){return x.id===id;});return t?t.icon:'ğŸ';}
function activM(){return DB.matches.find(function(m){return m.id===DB.activeMid;})||DB.matches[0]||null;}
function getPts(p){
  if(p.extPts!==undefined)return p.extPts;
  return calcPts((DB.scorecards[DB.activeMid]||{})[p.id]);
}
function rc(role){return{WK:'rt-wk',BAT:'rt-bat',BOWL:'rt-bwl','ALL-R':'rt-all'}[role]||'rt-bat';}
function getTeamIcon(name){
  var map={lion:'ğŸ¦',tiger:'ğŸ…',eagle:'ğŸ¦…',storm:'âš¡',royal:'ğŸ‘‘',bull:'ğŸ‚',warrior:'ğŸ›¡ï¸',blaze:'ğŸ”¥',titan:'ğŸ’ª',falcon:'ğŸ¦†',wolf:'ğŸº',fire:'ğŸ”¥',thunder:'âš¡',knight:'â™Ÿï¸',dragon:'ğŸ‰'};
  var l=(name||'').toLowerCase();
  for(var k in map)if(l.includes(k))return map[k];
  return 'ğŸ';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function connectGAS(){
  var url=document.getElementById('gas-url').value.trim();
  if(!url.startsWith('https://script.google.com')){
    showToast('âš ï¸ URL must start with https://script.google.com','err');return;
  }
  GAS_URL=url;
  localStorage.setItem('scf_gas',GAS_URL);
  launchApp();
  doSync();
}

function useDemoMode(){
  DEMO=true; GAS_URL='';
  launchApp();
  setSbar('Demo mode â€” using sample data. Enter real scores via âš™ï¸ Admin â†’ ğŸ“Š Scores','warn');
  renderHome(); renderSq();
}

function launchApp(){
  document.getElementById('setup').style.display='none';
  document.getElementById('app').style.display='flex';
}

function backToSetup(){
  document.getElementById('app').style.display='none';
  document.getElementById('setup').style.display='flex';
}

function copyGASCode(){
  var txt=document.getElementById('gas-code-block').textContent;
  navigator.clipboard.writeText(txt).then(function(){showToast('âœ… Code copied!','ok');}).catch(function(){showToast('Select and copy the code manually','warn');});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SYNC via Apps Script (no CORS issues)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function doSync(){
  if(DEMO||!GAS_URL){if(!DEMO)showToast('No Apps Script URL set','warn');return;}
  setSbar('Syncingâ€¦','wait');
  var btn=document.getElementById('sync-btn');
  btn.textContent='âŸ³ â€¦'; btn.classList.add('active');

  try{
    // Apps Script URL + ?t=timestamp to bust cache
    var url=GAS_URL+(GAS_URL.includes('?')?'&':'?')+'t='+Date.now();
    var resp=await fetch(url);
    if(!resp.ok)throw new Error('HTTP '+resp.status+' from Apps Script');
    var data=await resp.json();
    if(!data.ok&&data.error)throw new Error('Apps Script error: '+data.error);

    if(data.players&&data.players.length){
      var roleEmoji={WK:'ğŸ§¤',BAT:'ğŸ','ALL-R':'ğŸŒŸ',BOWL:'ğŸ¯'};
      DB.players=data.players.map(function(p,i){
        var role=(p.role||'BAT').toUpperCase();
        if(!['WK','BAT','ALL-R','BOWL'].includes(role))role='BAT';
        return{id:i+1,name:p.name,stid:'ext',teamName:p.team||'',role:role,
               emoji:p.emoji||roleEmoji[role]||'ğŸ',cr:parseFloat(p.cr)||8,extPts:parseFloat(p.pts)||0};
      });
    }

    if(data.match&&data.match.name){
      var am=activM();
      if(am){
        am.name=data.match.name;am.t1name=data.match.t1;am.t2name=data.match.t2;
        am.date=data.match.date||'';am.status=data.match.status||'live';
      }
    }

    LAST_SYNC=new Date();
    setSbar('âœ“ Live â€” synced '+LAST_SYNC.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})+' â€” '+DB.players.length+' players','ok');
    showToast('âœ… '+DB.players.length+' players synced!','ok');
    renderHome(); renderSq();
    setTimeout(doSync,5*60*1000);

  }catch(err){
    console.error(err);
    setSbar('Sync failed: '+err.message,'err');
    showToast('âŒ '+err.message,'err');
    document.getElementById('home-inner').innerHTML=
      '<div style="margin:14px;background:rgba(240,77,77,.07);border:1px solid rgba(240,77,77,.3);border-radius:14px;padding:20px">'
      +'<div style="font-size:36px;text-align:center;margin-bottom:10px">âš ï¸</div>'
      +'<div style="font-family:var(--font-hd);font-size:16px;color:var(--red);letter-spacing:1px;text-align:center;margin-bottom:12px">SYNC FAILED</div>'
      +'<div style="font-size:12.5px;color:var(--dim);line-height:1.75;margin-bottom:16px">'
      +'<b style="color:var(--text)">Error:</b> '+err.message+'<br><br>'
      +'<b style="color:var(--text)">Most likely cause:</b><br>'
      +'When deploying Apps Script, you chose <b>Execute as: Me</b> but didn\'t set <b>Who has access: Anyone</b>.<br><br>'
      +'<b style="color:var(--text)">Fix:</b> In Apps Script â†’ Deploy â†’ Manage deployments â†’ Edit â†’ change Who has access to <b>Anyone</b> â†’ Save<br><br>'
      +'Also make sure you clicked <b>Authorize</b> when prompted.'
      +'</div>'
      +'<div style="display:flex;gap:8px;justify-content:center">'
      +'<button class="btn btn-ol" onclick="doSync()">âŸ³ RETRY</button>'
      +'<button class="btn btn-ghost" onclick="backToSetup()">CHANGE URL</button>'
      +'</div></div>';
  }
  btn.textContent='âŸ³ Sync'; btn.classList.remove('active');
}

function setSbar(msg,state){
  var d=document.getElementById('sdot'),t=document.getElementById('stxt');
  if(d)d.className='sdot '+(state==='ok'?'ok':state==='err'?'err':'wait');
  if(t)t.textContent=msg;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showPage(pg){
  document.querySelectorAll('.page').forEach(function(p){p.classList.remove('active');});
  document.querySelectorAll('.bni').forEach(function(n){n.classList.remove('active');});
  document.getElementById('pg-'+pg).classList.add('active');
  var b=document.getElementById('bni-'+pg);if(b)b.classList.add('active');
  if(pg==='home')renderHome();
  if(pg==='squad')renderSq();
  if(pg==='myteam')renderMyTeam();
  if(pg==='lb')renderLB();
  if(pg==='admin')renderAdmin();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHome(){
  var am=activM(); if(!am)return;
  var t1n=am.t1name||stName(am.t1), t2n=am.t2name||stName(am.t2);
  var statusLbl=am.status==='live'?' â€¢ LIVE':am.status==='completed'?' â€¢ COMPLETED':' â€¢ UPCOMING';
  var pls=DB.players;
  var top=pls.slice().sort(function(a,b){return getPts(b)-getPts(a)||b.cr-a.cr;}).slice(0,8);
  var scored=pls.filter(function(p){return getPts(p)>0;}).sort(function(a,b){return getPts(b)-getPts(a);});
  var teams={};pls.forEach(function(p){var n=p.teamName||stName(p.stid);if(n&&n!=='â€“')teams[n]=1;});

  var showH='';
  if(scored.length){
    showH='<div class="showcase"><div class="sc-hdr"><div class="sc-hdr-t">ğŸ“Š LIVE SCORES</div>'
      +'<span style="font-size:11px;color:var(--dim)">'+am.name+'</span></div>'
      +'<div class="sc-scroll">'+scored.slice(0,14).map(function(p){
        return '<div class="sc-pl"><div class="sc-av">'+p.emoji+'<div class="sc-tag">'+getPts(p)+'</div></div>'
          +'<div class="sc-nm">'+p.name.split(' ')[0]+'</div><div class="sc-role">'+p.role+'</div></div>';
      }).join('')+'</div></div>';
  }

  document.getElementById('home-inner').innerHTML=
    '<div class="hero"><div class="hero-top"><div class="hero-bg">ğŸ†</div>'
    +'<div class="live-pill"><div class="lpulse"></div>'+am.name+statusLbl+'</div>'
    +'<div class="vs-row"><div class="tside"><span class="tem">'+getTeamIcon(t1n)+'</span><div class="tnm">'+t1n+'</div></div>'
    +'<div class="vsbadge">VS</div>'
    +'<div class="tside"><span class="tem">'+getTeamIcon(t2n)+'</span><div class="tnm">'+t2n+'</div></div></div>'
    +'<div class="hero-meta">'+am.date+'</div></div>'
    +'<div class="hero-acts"><button class="btn btn-g" onclick="showPage(\'squad\')">âš¡ CREATE TEAM</button>'
    +'<button class="btn btn-ol" onclick="showPage(\'lb\')">ğŸ† LEADERBOARD</button></div></div>'
    +'<div class="stat-strip">'
    +'<div class="sstat"><div class="sstat-n">'+Object.keys(teams).length+'</div><div class="sstat-l">Teams</div></div>'
    +'<div class="sstat"><div class="sstat-n">'+pls.length+'</div><div class="sstat-l">Players</div></div>'
    +'<div class="sstat"><div class="sstat-n">'+DB.mySquad.length+'</div><div class="sstat-l">My Squad</div></div>'
    +'<div class="sstat"><div class="sstat-n">'+(LAST_SYNC?LAST_SYNC.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}):'â€“')+'</div><div class="sstat-l">Synced</div></div>'
    +'</div>'+showH
    +'<div class="sec"><div class="sec-t">ğŸ”¥ Top Fantasy Picks</div></div>'
    +'<div class="plist">'+top.map(function(p){
      var tn=p.teamName||stIcon(p.stid)+' '+stName(p.stid);
      return '<div class="pc" onclick="showPage(\'squad\')" style="margin-bottom:7px">'
        +'<div class="pav">'+p.emoji+'</div><div class="pinfo"><div class="pname">'+p.name+'</div>'
        +'<div class="pmeta"><span class="rt '+rc(p.role)+'">'+p.role+'</span><span class="pteam">'+tn+'</span></div></div>'
        +'<div class="pr"><div class="ppts">'+(getPts(p)||'â€“')+'</div><div class="pptsl">PTS</div><div class="pcr">'+p.cr+' cr</div></div></div>';
    }).join('')+'</div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SQUAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSq(){
  var rnames={WK:'ğŸ§¤ Wicketkeeper',BAT:'ğŸ Batsman','ALL-R':'ğŸŒŸ All-Rounder',BOWL:'ğŸ¯ Bowler'};
  var html='';
  ['WK','BAT','ALL-R','BOWL'].forEach(function(role){
    if(sqFilt!=='ALL'&&sqFilt!==role)return;
    var grp=DB.players.filter(function(p){
      return p.role===role&&(!srch||p.name.toLowerCase().includes(srch.toLowerCase())||(p.teamName||stName(p.stid)).toLowerCase().includes(srch.toLowerCase()));
    }).sort(function(a,b){return getPts(b)-getPts(a)||b.cr-a.cr;});
    if(!grp.length)return;
    html+='<div class="role-grp-hdr">'+rnames[role]+' ('+grp.length+')</div>';
    grp.forEach(function(p){
      var sel=DB.mySquad.includes(p.id);
      var isC=DB.myCap===p.id,isV=DB.myVC===p.id;
      var pin=isC?'<span class="cpin cpinC">C</span>':isV?'<span class="cpin cpinVC">VC</span>':'';
      var tn=p.teamName||stIcon(p.stid)+' '+stName(p.stid);
      html+='<div class="pc'+(sel?' sel':'')+'" onclick="toggleSq('+p.id+')">'
        +'<div class="pav">'+p.emoji+pin+'</div>'
        +'<div class="pinfo"><div class="pname">'+p.name+'</div>'
        +'<div class="pmeta"><span class="rt '+rc(p.role)+'">'+p.role+'</span><span class="pteam">'+tn+'</span></div></div>'
        +'<div class="pr"><div class="ppts">'+(getPts(p)||'â€“')+'</div><div class="pptsl">PTS</div><div class="pcr">'+p.cr+' cr</div></div>'
        +'<div class="pchk">'+(sel?'âœ“':'')+'</div></div>';
    });
  });
  if(!html)html='<div style="text-align:center;padding:40px;color:var(--dim)">No players found.</div>';
  document.getElementById('sq-list').innerHTML=html;
  updateSqUI();
}
function setF(r,btn){sqFilt=r;document.querySelectorAll('.pill').forEach(function(p){p.classList.remove('on');});btn.classList.add('on');renderSq();}
function toggleSq(id){
  var p=DB.players.find(function(x){return x.id===id;});if(!p)return;
  var idx=DB.mySquad.indexOf(id);
  if(idx!==-1){DB.mySquad.splice(idx,1);if(DB.myCap===id)DB.myCap=null;if(DB.myVC===id)DB.myVC=null;}
  else{
    if(DB.mySquad.length>=10){showToast('Max 10 players!','err');return;}
    var used=DB.mySquad.reduce(function(s,i){return s+(DB.players.find(function(x){return x.id===i;})||{cr:0}).cr;},0);
    if(used+p.cr>100){showToast('Not enough credits!','warn');return;}
    DB.mySquad.push(id);
  }
  renderSq();
}
function updateSqUI(){
  var n=DB.mySquad.length;
  sqCr=DB.mySquad.reduce(function(s,id){return s+(DB.players.find(function(x){return x.id===id;})||{cr:0}).cr;},0);
  document.getElementById('b-n').textContent=n;
  document.getElementById('b-cr').textContent=(100-sqCr).toFixed(1);
  document.getElementById('b-prog').style.width=(n/10*100)+'%';
  document.getElementById('sq-nxt').disabled=n!==10;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CAP / VC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openCapM(){
  var sl=DB.mySquad.slice().sort(function(a,b){return getPts(DB.players.find(function(x){return x.id===b;})||{})-getPts(DB.players.find(function(x){return x.id===a;})||{});});
  document.getElementById('cap-opts').innerHTML=sl.map(function(id){
    var p=DB.players.find(function(x){return x.id===id;})||{emoji:'ğŸ',name:''};
    return '<div class="mopt'+(DB.myCap===id?' sel':'')+'" onclick="setCap('+id+')">'
      +p.emoji+' '+p.name+'<span class="mopt-r">'+getPts(p)+' pts â€¢ 2Ã—</span></div>';
  }).join('');
  openM('mod-cap');
}
function setCap(id){DB.myCap=id;if(DB.myVC===id)DB.myVC=null;closeM('mod-cap');setTimeout(openVCM,200);}
function openVCM(){
  var sl=DB.mySquad.filter(function(i){return i!==DB.myCap;}).sort(function(a,b){return getPts(DB.players.find(function(x){return x.id===b;})||{})-getPts(DB.players.find(function(x){return x.id===a;})||{});});
  document.getElementById('vc-opts').innerHTML=sl.map(function(id){
    var p=DB.players.find(function(x){return x.id===id;})||{emoji:'ğŸ',name:''};
    return '<div class="mopt'+(DB.myVC===id?' sel':'')+'" onclick="setVC('+id+')">'
      +p.emoji+' '+p.name+'<span class="mopt-r">'+getPts(p)+' pts â€¢ 1.5Ã—</span></div>';
  }).join('');
  openM('mod-vc');
}
function setVC(id){DB.myVC=id;closeM('mod-vc');renderSq();showToast('ğŸ‰ Team saved!','ok');setTimeout(function(){showPage('myteam');},500);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MY TEAM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMyTeam(){
  var el=document.getElementById('myteam-c');
  if(!DB.mySquad.length){
    el.innerHTML='<div style="text-align:center;padding:60px 20px">'
      +'<div style="font-size:60px;margin-bottom:16px">ğŸ</div>'
      +'<div style="font-family:var(--font-hd);font-size:22px;letter-spacing:2px;margin-bottom:8px">NO TEAM YET</div>'
      +'<div style="font-size:13px;color:var(--dim);margin-bottom:22px">Pick 10 players to build your squad</div>'
      +'<button class="btn btn-g" onclick="showPage(\'squad\')">âš¡ CREATE TEAM</button></div>';
    return;
  }
  var pls=DB.mySquad.map(function(id){return DB.players.find(function(x){return x.id===id;});}).filter(Boolean);
  var total=pls.reduce(function(s,p){var v=getPts(p);if(p.id===DB.myCap)v*=2;else if(p.id===DB.myVC)v*=1.5;return s+v;},0);
  var byR={WK:[],BAT:[],'ALL-R':[],BOWL:[]};
  pls.forEach(function(p){if(byR[p.role])byR[p.role].push(p);});
  var rows=['WK','BAT','ALL-R','BOWL'].filter(function(r){return byR[r].length;}).map(function(r){
    return '<div class="prow">'+byR[r].map(function(p){
      var iC=p.id===DB.myCap,iV=p.id===DB.myVC;
      var pin=iC?'<span class="cpin cpinC">C</span>':iV?'<span class="cpin cpinVC">VC</span>':'';
      var v=getPts(p);if(iC)v*=2;else if(iV)v*=1.5;
      return '<div class="pp"><div class="pp-av">'+p.emoji+pin+'</div>'
        +'<div class="pp-nm">'+p.name.split(' ')[0]+'</div>'
        +'<div class="pp-pts">'+(getPts(p)?Math.round(v)+'pts':'')+'</div></div>';
    }).join('')+'</div>';
  }).join('');
  el.innerHTML='<div class="stat-strip">'
    +'<div class="sstat"><div class="sstat-n">'+pls.length+'</div><div class="sstat-l">Players</div></div>'
    +'<div class="sstat"><div class="sstat-n">'+Math.round(total)+'</div><div class="sstat-l">Total Pts</div></div>'
    +'<div class="sstat"><div class="sstat-n">'+(100-sqCr).toFixed(1)+'</div><div class="sstat-l">Cr Left</div></div>'
    +'</div><div class="pitch"><div class="pitch-lines"></div>'+rows+'</div>'
    +'<div style="padding:0 12px 80px"><button class="btn btn-g btn-full" onclick="showPage(\'squad\')">âœï¸ EDIT TEAM</button></div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEADERBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLB(){
  document.getElementById('lb-sub').textContent=(activM()||{name:'SCF'}).name.toUpperCase();
  var sorted=DB.players.slice().sort(function(a,b){return getPts(b)-getPts(a);});
  var users=DB.lbUsers.map(function(u,i){
    var picks=sorted.slice(i*2,i*2+10);
    return Object.assign({},u,{score:u.base+Math.round(picks.reduce(function(s,p){return s+getPts(p);},0)*.4)});
  }).sort(function(a,b){return b.score-a.score;});
  var t3=users.slice(0,3);
  var po=[{d:t3[1],r:2,ps:'ps2',cl:'pod2'},{d:t3[0],r:1,ps:'ps1',cl:'pod1'},{d:t3[2],r:3,ps:'ps3',cl:'pod3'}];
  document.getElementById('lb-pod').innerHTML=po.filter(function(o){return o.d;}).map(function(o){
    return '<div class="pod '+o.cl+'"><div class="pod-av">'+o.d.emoji+'</div><div class="pod-nm">'+o.d.name.split(' ')[0]+'</div>'
      +'<div class="pod-sc">'+o.d.score+'</div><div class="pod-stand '+o.ps+'"></div><div class="pod-rk">#'+o.r+'</div></div>';
  }).join('');
  document.getElementById('lb-list').innerHTML=users.slice(3).map(function(u,i){
    return '<div class="lb-row" style="animation-delay:'+(i*.04)+'s"><div class="lb-rk">'+(i+4)+'</div>'
      +'<div class="lb-av">'+u.emoji+'</div><div class="lb-info"><div class="lb-nm">'+u.name+'</div>'
      +'<div class="lb-tnm">'+u.teamName+'</div></div><div class="lb-sc">'+u.score+'</div></div>';
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin(){
  var pw=document.getElementById('adm-pw').value;
  if(pw===DB.pw){
    DB.loggedIn=true;
    document.getElementById('adm-login-wrap').style.display='none';
    document.getElementById('adm-panel').style.display='block';
    showToast('âœ… Admin access granted','ok');
    renderAdmin();
  }else{showToast('âŒ Wrong password','err');document.getElementById('adm-pw').value='';}
}
function renderAdmin(){
  if(!DB.loggedIn)return;
  document.getElementById('adm-login-wrap').style.display='none';
  document.getElementById('adm-panel').style.display='block';
  renderATab();
}
function setATab(t,btn){aTab=t;document.querySelectorAll('.atab').forEach(function(x){x.classList.remove('on');});btn.classList.add('on');renderATab();}
function renderATab(){
  var el=document.getElementById('adm-content');
  if(aTab==='matches')el.innerHTML=tplMatches();
  else if(aTab==='scores')el.innerHTML=tplScores();
  else if(aTab==='players')el.innerHTML=tplPlayers();
  else if(aTab==='teams')el.innerHTML=tplTeams();
}

function tplMatches(){
  var tOpts=DB.socTeams.map(function(t){return '<option value="'+t.id+'">'+t.icon+' '+t.name+'</option>';}).join('');
  return '<div class="acard"><div class="acard-hdr"><div><div class="acard-t">â• New Match</div></div></div>'
    +'<div class="acard-body"><div class="fg">'
    +'<div class="fw"><label>Match Name</label><input class="finp" id="nm-n" placeholder="Match 1 â€” Finals"></div>'
    +'<div class="fw"><label>Date</label><input class="finp" id="nm-d" placeholder="Sunday 22 June"></div></div>'
    +'<div class="fg">'
    +'<div class="fw"><label>Team 1</label><select class="finp" id="nm-t1"><option value="">Select</option>'+tOpts+'</select></div>'
    +'<div class="fw"><label>Team 2</label><select class="finp" id="nm-t2"><option value="">Select</option>'+tOpts+'</select></div></div>'
    +'<div class="fw"><label>Status</label><select class="finp" id="nm-s"><option value="upcoming">Upcoming</option><option value="live">Live</option><option value="completed">Completed</option></select></div>'
    +'<button class="btn btn-g btn-full" style="margin-top:9px" onclick="createMatch()">CREATE MATCH</button></div></div>'
    +DB.matches.map(function(m){
      var t1n=m.t1name||stName(m.t1),t2n=m.t2name||stName(m.t2);
      var isA=DB.activeMid===m.id;
      return '<div class="acard" style="'+(isA?'border-color:rgba(0,232,162,.35)':'')+'">'
        +'<div class="acard-hdr"><div><div class="acard-t">'+m.name+'</div>'
        +'<div class="acard-s">'+t1n+' vs '+t2n+(m.date?' â€¢ '+m.date:'')+'</div></div>'
        +'<div style="display:flex;gap:6px">'
        +(isA?'<span style="font-family:var(--font-hd);font-size:10px;color:var(--g);border:1px solid var(--g);border-radius:6px;padding:2px 8px">ACTIVE</span>'
             :'<button class="btn btn-ol btn-sm" onclick="setActM(\''+m.id+'\')">SET ACTIVE</button>')
        +'<button class="btn btn-red btn-sm" onclick="delMatch(\''+m.id+'\')">DEL</button>'
        +'</div></div></div>';
    }).join('');
}
function createMatch(){
  var n=document.getElementById('nm-n').value.trim(),d=document.getElementById('nm-d').value.trim(),
      t1=document.getElementById('nm-t1').value,t2=document.getElementById('nm-t2').value,
      s=document.getElementById('nm-s').value;
  if(!n||!t1||!t2){showToast('Fill name and both teams','warn');return;}
  if(t1===t2){showToast('Teams must differ','warn');return;}
  DB.matches.push({id:'m'+(m_ctr++),name:n,t1:t1,t2:t2,status:s,date:d});
  showToast('âœ… Match created!','ok');renderATab();
}
function setActM(id){DB.activeMid=id;showToast('âœ… Active match set','ok');renderATab();renderHome();}
function delMatch(id){DB.matches=DB.matches.filter(function(m){return m.id!==id;});if(DB.activeMid===id&&DB.matches.length)DB.activeMid=DB.matches[0].id;showToast('Deleted','warn');renderATab();}

function tplScores(){
  if(!DB.activeMid)return '<div style="text-align:center;padding:30px;color:var(--dim)">Create and activate a match first.</div>';
  if(!DB.scorecards[DB.activeMid])DB.scorecards[DB.activeMid]={};
  var sc=DB.scorecards[DB.activeMid];
  var am=activM();
  var fbox='<div class="fbox"><div class="fbox-t">ğŸ“ Scoring Formula</div><div class="fgrid">'
    +'<div class="fi"><span class="fil">Run</span><span class="fiv">+1</span></div>'
    +'<div class="fi"><span class="fil">Wicket</span><span class="fiv">+25</span></div>'
    +'<div class="fi"><span class="fil">Catch</span><span class="fiv">+10</span></div>'
    +'<div class="fi"><span class="fil">Stumping</span><span class="fiv">+15</span></div>'
    +'<div class="fi"><span class="fil">Run-out</span><span class="fiv">+12</span></div>'
    +'<div class="fi"><span class="fil">Maiden</span><span class="fiv">+8</span></div>'
    +'<div class="fi"><span class="fil">50 runs bonus</span><span class="fiv">+20</span></div>'
    +'<div class="fi"><span class="fil">100 runs bonus</span><span class="fiv">+50</span></div>'
    +'<div class="fi"><span class="fil">3-wkt haul</span><span class="fiv">+15</span></div>'
    +'<div class="fi"><span class="fil">5-wkt haul</span><span class="fiv">+30</span></div>'
    +'<div class="fi"><span class="fil">Duck (out+5balls)</span><span class="fiv">âˆ’5</span></div>'
    +'<div class="fi"><span class="fil">Captain</span><span class="fiv">2Ã—</span></div>'
    +'</div></div>';
  var rows=DB.players.map(function(p){
    var s=sc[p.id]||{};
    var tn=p.teamName||stIcon(p.stid)+' '+stName(p.stid);
    var pts=calcPts(s);
    return '<div class="sc-ec"><div class="sc-eh">'
      +'<span style="font-size:20px">'+p.emoji+'</span>'
      +'<div style="flex:1;min-width:0"><div class="sc-enm">'+p.name+'</div>'
      +'<div style="display:flex;gap:5px;margin-top:2px"><span class="rt '+rc(p.role)+'" style="font-size:9px">'+p.role+'</span>'
      +'<span style="font-size:10px;color:var(--dim)">'+tn+'</span></div></div>'
      +'<div class="sc-live" id="plv-'+p.id+'">'+pts+' pts</div></div>'
      +'<div class="sc-fields">'
      +['runs:Runs','balls:Balls','wkts:Wkts','catches:Catch','stmps:Stump','runouts:RO','maidens:Maiden'].map(function(kl){
        var kv=kl.split(':');
        return '<div class="sff"><label>'+kv[1]+'</label>'
          +'<input class="sfinp" type="number" min="0" id="sf_'+p.id+'_'+kv[0]+'" value="'+(s[kv[0]]||0)+'" oninput="liveP('+p.id+')"></div>';
      }).join('')
      +'<div class="sff"><label>Out?</label>'
      +'<select class="sfinp" id="sf_'+p.id+'_dismissed" onchange="liveP('+p.id+')">'
      +'<option value=""'+((!s.dismissed)?'selected':'')+'>No</option>'
      +'<option value="1"'+((s.dismissed)?'selected':'')+'>Yes</option>'
      +'</select></div>'
      +'</div></div>';
  }).join('');
  return fbox+'<div class="acard"><div class="acard-hdr"><div>'
    +'<div class="acard-t">ğŸ“Š Enter Scores â€” '+(am?am.name:'')+'</div>'
    +'<div class="acard-s">Points update live â€¢ '+DB.players.length+' players</div>'
    +'</div></div><div class="acard-body">'+rows
    +'<button class="btn btn-g btn-full" style="margin-top:12px" onclick="saveScores()">ğŸ’¾ SAVE ALL SCORES</button>'
    +'</div></div>';
}
function liveP(pid){
  var s={};
  ['runs','balls','wkts','catches','stmps','runouts','maidens'].forEach(function(k){var e=document.getElementById('sf_'+pid+'_'+k);if(e)s[k]=e.value;});
  var de=document.getElementById('sf_'+pid+'_dismissed');if(de)s.dismissed=de.value;
  var el=document.getElementById('plv-'+pid);
  if(el){var p=calcPts(s);el.textContent=p+' pts';el.style.color=p>0?'var(--gold)':'var(--dim)';}
}
function saveScores(){
  var mid=DB.activeMid;if(!DB.scorecards[mid])DB.scorecards[mid]={};
  DB.players.forEach(function(p){
    var s={};
    ['runs','balls','wkts','catches','stmps','runouts','maidens'].forEach(function(k){var e=document.getElementById('sf_'+p.id+'_'+k);if(e)s[k]=e.value;});
    var de=document.getElementById('sf_'+p.id+'_dismissed');if(de)s.dismissed=de.value;
    p.extPts=calcPts(s);
    DB.scorecards[mid][p.id]=s;
  });
  showToast('âœ… Scores saved! Points updated.','ok');
  renderHome();renderLB();
}

function tplPlayers(){
  var tOpts=DB.socTeams.map(function(t){return '<option value="'+t.id+'">'+t.icon+' '+t.name+'</option>';}).join('');
  var rOpts=['WK','BAT','ALL-R','BOWL'].map(function(r){return '<option value="'+r+'">'+r+'</option>';}).join('');
  var byTeam='';
  DB.socTeams.forEach(function(st){
    var pls=DB.players.filter(function(p){return p.stid===st.id;});if(!pls.length)return;
    byTeam+='<tr><td colspan="4" style="background:rgba(61,163,255,.05);padding:5px 9px;font-family:var(--font-hd);font-size:10px;color:var(--blue);letter-spacing:1px">'+st.icon+' '+st.name+' ('+pls.length+')</td></tr>';
    pls.forEach(function(p){
      byTeam+='<tr><td>'+p.emoji+' '+p.name+'</td><td><span class="rt '+rc(p.role)+'" style="font-size:9px">'+p.role+'</span></td>'
        +'<td style="color:var(--gold)">'+p.cr+'cr</td><td><button class="td-del" onclick="delPlayer('+p.id+')">ğŸ—‘ï¸</button></td></tr>';
    });
  });
  var ext=DB.players.filter(function(p){return p.stid==='ext';});
  if(ext.length){
    byTeam+='<tr><td colspan="4" style="background:rgba(0,232,162,.05);padding:5px 9px;font-family:var(--font-hd);font-size:10px;color:var(--g)">ğŸ“¡ From Google Sheet ('+ext.length+')</td></tr>';
    ext.slice(0,8).forEach(function(p){
      byTeam+='<tr><td>'+p.emoji+' '+p.name+'</td><td><span class="rt '+rc(p.role)+'" style="font-size:9px">'+p.role+'</span></td>'
        +'<td style="color:var(--gold)">'+p.cr+'cr</td><td style="color:var(--dim)">sheet</td></tr>';
    });
    if(ext.length>8)byTeam+='<tr><td colspan="4" style="color:var(--dim);font-size:11px;padding:6px 9px">â€¦and '+(ext.length-8)+' more</td></tr>';
  }
  return '<div class="acard"><div class="acard-hdr"><div><div class="acard-t">â• Add Player</div><div class="acard-s">Total: '+DB.players.length+' players</div></div></div>'
    +'<div class="acard-body"><div class="fg">'
    +'<div class="fw"><label>Full Name</label><input class="finp" id="np-n" placeholder="Player name"></div>'
    +'<div class="fw"><label>Society Team</label><select class="finp" id="np-t"><option value="">Select</option>'+tOpts+'</select></div></div>'
    +'<div class="fg"><div class="fw"><label>Role</label><select class="finp" id="np-r">'+rOpts+'</select></div>'
    +'<div class="fw"><label>Credits (6â€“10)</label><input class="finp" id="np-c" type="number" min="6" max="10" step="0.5" value="8.0"></div>'
    +'<div class="fw" style="min-width:70px;max-width:80px"><label>Emoji</label><input class="finp" id="np-e" value="ğŸ" maxlength="2"></div></div>'
    +'<button class="btn btn-g btn-full" onclick="addPlayer()">ADD PLAYER</button></div></div>'
    +'<div class="acard"><div class="acard-hdr"><div><div class="acard-t">ğŸ‘¥ All Players ('+DB.players.length+')</div></div></div>'
    +'<div style="overflow-x:auto;padding-bottom:10px"><table class="dtbl"><thead><tr><th>Name</th><th>Role</th><th>Cr</th><th></th></tr></thead><tbody>'+byTeam+'</tbody></table></div></div>';
}
function addPlayer(){
  var n=document.getElementById('np-n').value.trim(),t=document.getElementById('np-t').value,
      r=document.getElementById('np-r').value,c=parseFloat(document.getElementById('np-c').value)||8,
      e=document.getElementById('np-e').value||'ğŸ';
  if(!n||!t){showToast('Name and team are required','warn');return;}
  DB.players.push({id:pid_ctr++,name:n,stid:t,role:r,emoji:e,cr:c,extPts:0});
  document.getElementById('np-n').value='';
  showToast('âœ… Player added ('+DB.players.length+' total)','ok');
  renderATab();
}
function delPlayer(id){DB.players=DB.players.filter(function(p){return p.id!==id;});DB.mySquad=DB.mySquad.filter(function(i){return i!==id;});showToast('Removed','warn');renderATab();}

function tplTeams(){
  var cards=DB.socTeams.map(function(st){
    var cnt=DB.players.filter(function(p){return p.stid===st.id;}).length;
    return '<div class="acard"><div class="acard-hdr">'
      +'<div><div class="acard-t">'+st.icon+' '+st.name+'</div><div class="acard-s">'+cnt+'/9 players'+(cnt>=9?' âœ…':'')+'</div></div>'
      +'<button class="td-del" style="font-size:17px" onclick="delTeam(\''+st.id+'\')">ğŸ—‘ï¸</button></div>'
      +'<div style="padding:0 13px 11px"><div style="height:4px;background:var(--border);border-radius:2px;overflow:hidden">'
      +'<div style="width:'+Math.min(Math.round(cnt/9*100),100)+'%;height:100%;background:var(--gg);border-radius:2px"></div>'
      +'</div></div></div>';
  }).join('');
  return '<div class="acard"><div class="acard-hdr"><div><div class="acard-t">â• Add Society Team</div><div class="acard-s">Target: 22 teams (current: '+DB.socTeams.length+')</div></div></div>'
    +'<div class="acard-body"><div class="fg">'
    +'<div class="fw"><label>Team Name</label><input class="finp" id="nt-n" placeholder="Block A Warriors"></div>'
    +'<div class="fw" style="min-width:80px;max-width:90px"><label>Emoji</label><input class="finp" id="nt-i" value="ğŸ" maxlength="2"></div></div>'
    +'<button class="btn btn-g btn-full" onclick="addTeam()">ADD TEAM</button></div></div>'+cards;
}
function addTeam(){
  var n=document.getElementById('nt-n').value.trim(),i=document.getElementById('nt-i').value||'ğŸ';
  if(!n){showToast('Team name required','warn');return;}
  DB.socTeams.push({id:'st'+(st_ctr++),name:n,icon:i});
  document.getElementById('nt-n').value='';showToast('âœ… Team added','ok');renderATab();
}
function delTeam(id){
  if(DB.players.filter(function(p){return p.stid===id;}).length){showToast('Remove players from this team first','err');return;}
  DB.socTeams=DB.socTeams.filter(function(t){return t.id!==id;});showToast('Removed','warn');renderATab();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL / TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openM(id){document.getElementById(id).classList.add('open');}
function closeM(id){document.getElementById(id).classList.remove('open');}
document.querySelectorAll('.backdrop').forEach(function(b){b.addEventListener('click',function(e){if(e.target===b)b.classList.remove('open');});});
var _tt;
function showToast(msg,type){var t=document.getElementById('toast');t.textContent=msg;t.className='toast '+(type||'')+' show';clearTimeout(_tt);_tt=setTimeout(function(){t.classList.remove('show');},2800);}

// INIT
(function(){
  var gas=localStorage.getItem('scf_gas');
  if(gas){GAS_URL=gas;document.getElementById('gas-url').value=gas;launchApp();doSync();}
})();
</script>
</body>
</html>
